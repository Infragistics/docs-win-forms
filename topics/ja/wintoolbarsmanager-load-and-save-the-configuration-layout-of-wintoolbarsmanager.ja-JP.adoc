////

|metadata|
{
    "name": "wintoolbarsmanager-load-and-save-the-configuration-layout-of-wintoolbarsmanager",
    "controlName": ["WinToolbarsManager"],
    "tags": ["Layouts","Persistence"],
    "guid": "{1EFF2E6A-F033-41BB-A464-EA8D0CDE91EB}",  
    "buildFlags": [],
    "createdOn": "2005-07-07T00:00:00Z"
}
|metadata|
////

= 構成レイアウトのWinToolbarsManagerへのロードと保存

WinToolbarsManager の構成レイアウトは、アプリケーションを実行するたびにロードおよび保存できます。このファイルは、バイナリ形式で保存される場合は拡張子 DAT で保存され、XML 形式で保存される場合は拡張子 XML で保存されます。このファイルにはツールバーおよびツールのレイアウトとプロパティが格納されており、複数のアプリケーションで使用できます。

== デザインタイムの場合

UltraToolBarsManager を右クリックして ［構成の読み込みと保存］ を選択します。ファイルがすでに存在する場合は、形式を選択してファイルを特定し、ロードします。ツールバーのレイアウトを後で使用できるように保存するには、作成したレイアウトの保存オプションと形式を選択して保存します。

== ランタイムの場合

*Visual Basic の場合：*

----
Private Sub LoadandSaveWinToolbarsLayoutandStateofToolbarsandTools_Load(ByVal sender As System.Object, _
  ByVal e As System.EventArgs) Handles MyBase.Load
	LoadToolbarLayout()
End Sub
Private Sub LoadToolbarLayout()
	Dim fs As FileStream
	Try
		fs = New FileStream(System.IO.Path.Combine(Application.StartupPath, _
		  "..\ExtraFiles\ToolbarLayout.dat"), FileMode.Open)
		fs.Seek(0, SeekOrigin.Begin)
		Me.UltraToolbarsManager1.LoadFromBinary(fs)
	Catch ex As Exception
	Finally
		If Not fs Is Nothing Then
			fs.Close()
		End If
	End Try
End Sub
Private Function GetAppPath() As String
	Dim f As New DirectoryInfo(Application.ExecutablePath)
	Return f.Parent.FullName
End Function
Private Sub frmMain_Closing(ByVal sender As Object, _
  ByVal e As System.ComponentModel.CancelEventArgs) _
  Handles MyBase.Closing
	SaveToolbarLayout()
End Sub
Private Sub SaveToolbarLayout()
	Dim fs As New FileStream("ToolbarLayout.dat", FileMode.OpenOrCreate)
	fs.Seek(0, SeekOrigin.Begin)
	Me.UltraToolbarsManager1.SaveAsBinary(fs, True)
	fs.Close()
End Sub
----

*C# の場合：*

----
private void LoadandSaveWinToolbarsLayoutandStateofToolbarsandTools_Load(object sender, 
  System.EventArgs e)
{
	LoadToolbarLayout();
}
private void LoadToolbarLayout()
{
	FileStream fs = null;
	if (!File.Exists(System.IO.Path.Combine(Application.StartupPath, 
	  @"..\..\ExtraFiles\ToolbarLayout.dat")))
		return;
	try
	{
		fs = new FileStream(System.IO.Path.Combine(Application.StartupPath, 
		  @"..\..\ExtraFiles\ToolbarLayout.dat"), FileMode.Open);
		fs.Seek(0, SeekOrigin.Begin);
		this.ultraToolbarsManager1.LoadFromBinary(fs);
	}
	finally
	{
		if (!(fs == null))
		{
			fs.Close();
		}
	}
}
private string GetAppPath()
{
	DirectoryInfo f = new DirectoryInfo(Application.ExecutablePath);
	return f.Parent.FullName;
}
private void LoadandSaveWinToolbarsLayoutandStateofToolbarsandTools_Closing(object sender, 
  System.ComponentModel.CancelEventArgs e)
{
	SaveToolbarLayout();
}
private void SaveToolbarLayout()
{
	FileStream fs = new FileStream("ToolbarLayout.dat", FileMode.OpenOrCreate);
	fs.Seek(0, SeekOrigin.Begin);
	this.ultraToolbarsManager1.SaveAsBinary(fs, true);
	fs.Close();
}
----